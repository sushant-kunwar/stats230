---
title: "Final Project"
output:
  word_document: default
  html_document: default
date: "2024-04-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
States <- read.csv("/Users/sushantkunwar/Downloads/archive (1)/states_all_extended.csv")
```

## Load Libraries
```{r, message = FALSE}
library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(MASS)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
```

**INTRODUCTION**

In this project, we aim to analyze a comprehensive dataset that encapsulates various dimensions of U.S. education data, consolidating financial, demographic, and academic performance indicators at the state level into a single accessible format. The dataset, drawn from multiple authoritative sources, includes detailed breakdowns by race, gender, and grade level, alongside revenue and expenditure figures. By focusing on data from the years 1992 and 2015, we intend to explore changes and trends over time, providing insights into the evolution of educational environments across the states. This analysis not only seeks to uncover underlying patterns in educational achievement and funding but also to highlight areas of progress and ongoing challenges within the U.S. educational system.



**DATA**

YEAR: The year that the data is from

STATE: The state that the data is from

ENROLL: The U.S. Census Bureau's count for students in the state. Should be comparable to GRADES_ALL

A_A_A (same as GRADES_ALL): Should be same data as above

ENROLLMENT: max of 2 Columns with data from different sources(ENROLL & A_A_A)

TOTAL_REVENUE: The total amount of revenue for the state. (in dollars)

TOTAL_EXPENDITURE: The total expenditure for the state. (in dollars)

INSTRUCTION_EXPENDITURE: Expenditure going toward instruction (in dollars)

PROP_INSTR_EXP: proportion instruction expenditure CREATE THIS ONE (JUST INSTRUCTION/TOTAL)

G08_A_A_MATHEMATICS: Average math score of eighth grade students

G08_A_M_MATHEMATICS: Average math score of eighth grade students that are classified as "male"

G08_A_F_MATHEMATICS: Average math score of eighth grade students that are classified as "female"

MATH_GENDER_DIF: CREATE THIS ONE (just G08_A_M_MATHEMATICS - G08_A_F_MATHEMATICS)

## Data Cleaning
```{r echo = F}

#Creating a Unified ENROLLMENT column by taking the max of 2 Columns with data from different sources(ENROLL & A_A_A)
States$ENROLLMENT <- pmax(States$A_A_A, States$ENROLL, na.rm = T)


#New Variable: Proportional Instruction Expenditure
States$PROP_INSTRUCTION_EXPENDITURE <- States$INSTRUCTION_EXPENDITURE / States$TOTAL_EXPENDITURE

#New Variable: Difference between Male and Female Math Scores in Grade 8(M-F)
States$MATH_GENDER_DIF <- States$G08_A_M_MATHEMATICS - States$G08_A_F_MATHEMATICS

#Rename Variables:
States$AVG_MATH <- States$G08_A_A_MATHEMATICS
States$AVG_MATH_M <- States$G08_A_M_MATHEMATICS
States$AVG_MATH_F <- States$G08_A_F_MATHEMATICS
States$SCORE_ASIAN <- States$G08_AM_A_MATHEMATICS
States$SCORE_NATIVE_AM <- States$G08_AS_A_MATHEMATICS
States$SCORE_HISPANIC_LATINO <- States$G08_HI_A_MATHEMATICS
States$SCORE_BLACK <- States$G08_BL_A_MATHEMATICS
States$SCORE_WHITE <- States$G08_WH_A_MATHEMATICS
States$SCORE_HAWAIIAN_PI <- States$G08_HP_A_MATHEMATICS
States$SCORE_MULTIPLE_RACES <- States$G08_TR_A_MATHEMATICS

#Creating a data frame for data from just 1992
States1992 <- States[c(1:51), ]


#Creating a data frame for data from just 2016
States2015 <- States[c(1174:1224), ]


#making the row numbers the state name 1992
rownames(States1992) <- States1992$STATE

#Removing the PRIMARY_KEY and STATE columns as it'll be redundant/confusing later 1992
States1992 <- States1992[ ,-1]
States1992 <- States1992[ ,-1]


#making the row numbers the state name 2015
rownames(States2015) <- States2015$STATE

#Removing the PRIMARY_KEY and STATE columns as it'll be redundant/confusing later 2015
States2015 <- States2015[ ,-1]
States2015 <- States2015[ ,-1]


#Removing Columns with all NAs
States1992 <- States1992[ ,colSums(is.na(States1992)) < nrow(States1992)]


States2015 <- States2015[ ,colSums(is.na(States2015)) < nrow(States2015)]


```
**ALL PLOTS**

*Plots*

```{r, echo=FALSE}

#Scatter plot comparing total instruction expenditure and avg math score (1992 and 2015)
plot(States1992$AVG_MATH ~ States1992$INSTRUCTION_EXPENDITURE, ylab = "Average Math Score", main = "Plot of Total  Expenditure on Instruction vs Avg Math Score in 1992", xlab = "Total Expenditure", pch = 19)

plot(States2015$AVG_MATH ~ States2015$INSTRUCTION_EXPENDITURE, ylab = "Average Math Score", main = "Plot of Total Expenditure on Instruction vs Avg Math Score in 2015", xlab = "Total Expenditure", pch = 19)
```

*Plot 1: This scatter plot shows the relationship between total expenditure on instruction and average math score in 1992. There appears to be a positive correlation, with higher expenditures generally associated with higher average math scores, though the relationship is not perfectly linear. The data points are widely scattered, suggesting substantial variability.*

*Plot 2: This scatter plot displays the same variables as the previous one, but for the year 2015. Here, the positive correlation between total expenditure on instruction and average math score seems more pronounced, with the data points more tightly clustered around an upward-sloping trend line. The overall range of expenditures has also increased compared to 1992.*

```{r}
#Scatter plot comparing proportional expenditure and avg math score (1992 and 2015)
plot(States1992$AVG_MATH ~ States1992$PROP_INSTRUCTION_EXPENDITURE, ylab = "Average Math Score", main = "Plot of Proportional Expenditure on Instruction vs Avg Math Score in 1992", xlab = "Proportional Expenditure", pch = 19)

plot(States2015$AVG_MATH ~ States2015$PROP_INSTRUCTION_EXPENDITURE, ylab = "Average Math Score", main = "Plot of Proportional Expenditure on Instruction vs Avg Math Score in 2015", xlab = "Proportional Expenditure", pch = 19)
```

*Plot 3: This scatter plot displays the relationship between the proportional expenditure on instruction and average math score in 1992. Like the plot displaying the total expenditure, there is a positive correlation, but in this graph it is much more pronounced. This indicates that we can see a far stronger correlation when we take into account not just the size of the expenditure on instruction, but rather how much of the total expenditure goes to correlation. Here we can see that when a higher proportion of the budget goes to instruction, we would expect that the average math score would increase.*

*Plot 4: The variables in this plot are the same as the previous plot, this plot just focuses on 2015. Just like the previous plot, this one demonstrates how we should take into account the proportion of the total expenditure that goes to instruction rather than just the total expenditure on instruction. The different sizes of different states will skew the data if we only focus on the total expenditure on instruction. We see a much stronger positive correlation in this plot.*

```{r}
boxplot(States1992$AVG_MATH_M, States1992$AVG_MATH_F, main = "Box plot of Avg math scores in 1992", xlab = "Gender", ylab = "Score", col = c("blue", "pink"))
boxplot(States2015$AVG_MATH_M, States2015$AVG_MATH_F, main = "Box plot of Avg math scores in 2015", xlab = "Gender", ylab = "Score", col = c("blue", "pink"))
```

*Plot 5: This box plot displays the average math scores accross all states in 1992, divided by gender. In this plot, both men and women have one outlier far below the other states with average scores below 240. It seems as though men have generally higher scores than women in math. The median, quartiles, min, and max are all higher for men then they are for women, indicating that men are performing better than women in math.*

*Plot 6: This box plot displays the average math scores accross all states in 2015, divided by gender. In this plot, unlike in 1992, men have an outlier further below, but it is only at a score of 260. Furthermore, women actually have an outlier further ABOVE, which did not occur in 1992. Additionally, it actually seems as though men and women have similar math scores, but women have a higher mean. Based on this plot and the former, it seems as though while scores for both men and women increased, the scores for women certainly increased the most.*

```{r}
hist(States1992$MATH_GENDER_DIF)
hist(States2015$MATH_GENDER_DIF)
```
*Plot 7: This histogram displays the frequency distribution of the states' math gender difference scores in 1992. The distribution looks pretty normal with a center at 0, but it still seems as though male scores tend to be higher since most states fall with a difference above 0 (meaning men have a higher score). Still, it seems more even than we would have believed from the box plots.*

*Plot 8: This histogram displays the frequency distribution of the states' math gender difference scores in 2015. The distribution appears to be slightly skewed to the left, with the large majority of states falling below a difference of 0 (meaning that women tended to have a higher average score than men in. most states). This is certainly a change from 1992 where men had higher scores, but the data was more centered around 0 and normally distributed. This seems to be less normally distributed, as we will see in the qq plot.*

```{r}
qqPlot(States1992$MATH_GENDER_DIF)
qqPlot(States2015$MATH_GENDER_DIF)
```

*Plot 9: This graph depicts the quantiles of a standard normal distribution, with the x-axis representing the norm quantiles and the y-axis showing the states' 1992 math gender difference scores. The points closely follow the diagonal line, suggesting that the gender difference scores are approximately normally distributed.*

*Plot 10: Similar to the previous graph, this one shows the quantiles of the states' 2015 math gender difference scores plotted against the norm quantiles. The points appear to deviate slightly from the diagonal line, indicating a potential departure from normality, though the deviation is relatively small.*


*Tests*

```{r}
#T=Tests
t.test(States1992$AVG_MATH_M, States1992$AVG_MATH_F)
t.test(States2015$AVG_MATH_M, States2015$AVG_MATH_F)
t.test(States1992$AVG_MATH, States2015$AVG_MATH)

#Bootstrapped Confidence Interval Between Proportional Expenditures and MATH AVG SCORES
N <- 51
n_samp <- 10000

corResults1992 <- rep(NA, n_samp)
corResults2015 <- rep(NA, n_samp)

for(i in 1:n_samp){
  #get vector of rows in our fake sample
  s <- sample(1:N, N , replace = T)
  data1992 <- na.omit(States1992[s, ])
  data2015 <- States2015[s, ]
    
  #Get bootstrapped correlation and regression slope
  
  corResults1992[i] <- cor(data1992$PROP_INSTRUCTION_EXPENDITURE, data1992$AVG_MATH)
  corResults2015[i] <- cor(data2015$PROP_INSTRUCTION_EXPENDITURE, data2015$AVG_MATH)
}
ci1992 <- quantile(corResults1992, c(.025, .975), na.rm = T)
ci2015 <- quantile(corResults2015, c(.025, .975), na.rm = T)

print("1992 BootStrapped Correlations")
ci1992
print("2015 BootStrapped Correlations")
ci2015
```

## Permutation Test

```{r}
set.seed(230)

diff <- median(States2015$AVG_MATH_M) - median(States2015$AVG_MATH_F)
diff

n <- 10000 
fdiff <- rep(NA, n)
for (i in 1:n) {
  fakegender <- sample(c("M", "F"), 51, replace = T)
  fdiff[i] <- median(States2015$AVG_MATH_M[fakegender == "M"]) - median(States2015$AVG_MATH_F[fakegender == "F"])
}

hist(fdiff, main = "Permuted Sample Medians of Scores Between Genders", col = "blue", xlab = "Minute Difference", cex.main = .9)
abline(v = diff, col = "red", lwd = 2)
text(diff - 0.2, 750 , paste("Actual Diff in Medians =", round(diff,2)),srt = 90)
pval <-mean(abs(fdiff) >= abs(diff))
pval
```

*Bootstraps*

```{r}
hist(corResults1992, main = "Histogram of Bootstrapped Correlations(1992)", col = "purple", xlab = "Sample Correlations", breaks = 50)
abline(v = ci1992, lwd = 3, col = "darkgreen")
abline(v = cor.test(States1992$PROP_INSTRUCTION_EXPENDITURE, States1992$AVG_MATH)$conf.int, lwd = 3, col = "lightblue", lty = 2)
legend("topleft", c("Paramteric CI", "Boot CI"), lwd = 4, col = c("lightblue", "darkgreen"), lty = c(2, 1))

hist(corResults2015, main = "Histogram of Bootstrapped Correlations(2015)", col = "violet", xlab = "Sample Correlations", breaks = 50)
abline(v = ci2015, lwd = 3, col = "darkgreen")
abline(v = cor.test(States2015$PROP_INSTRUCTION_EXPENDITURE, States2015$AVG_MATH)$conf.int, lwd = 3, col = "lightblue", lty = 2)
legend("topleft", c("Parametric CI", "Boot CI"), lwd = 4, col = c("lightblue", "darkgreen"), lty = c(2, 1))
```
Histogram 1 (1992): The histogram displays a distinct peak around 0.3, indicating a concentration of bootstrapped correlation values around that point. The parametric confidence interval (teal line) appears narrower compared to the bootstrap confidence interval (green line), suggesting a tighter estimation range. There are some extreme values on both tails of the distribution, though more pronounced on the positive side.
Histogram 2 (2015): The distribution of bootstrapped correlations in 2015 exhibits a similar shape to the 1992 data, with a pronounced peak near 0.2. However, the peak appears slightly shifted to the left compared to 1992. The parametric confidence interval remains narrower than the bootstrap interval, consistent with the earlier observation. The tails of the distribution seem less extreme, particularly on the positive side, when compared to the 1992 data.

*ANOVA TESTING*
```{r}

AOV <- aov(AVG_MATH ~  SCORE_NATIVE_AM + SCORE_HISPANIC_LATINO + SCORE_BLACK + SCORE_WHITE + SCORE_MULTIPLE_RACES, data = States2015)
summary(AOV)

myResPlots2(AOV)
```
The ANOVA test examines the effect of different racial/ethnic groups on the math exam scores for 8th graders. The results show a statistically significant effect for the SCORE_HISPANIC_LATINO group (p = 0.02308) and the SCORE_WHITE group (p = 0.00633) at the 0.05 level. This suggests that the mean scores for Hispanic/Latino and White students differ significantly from the overall mean. However, the effects for Asian, Native American, Black, and Multiple Races groups are not statistically significant at the 0.05 level. The residual degrees of freedom (44) indicate a relatively small sample size, which may impact the power of the test to detect smaller effect sizes.

The residuals appear to be randomly scattered around zero, indicating that the assumption of homoscedasticity (constant variance of residuals) is likely met. However, there seems to be a slight pattern where the residuals become more positive as the fitted values increase, suggesting a potential violation of the linearity assumption.

The Q-Q plot shows a reasonably straight line, implying that the residuals follow a normal distribution. However, there are a few points at the tails that deviate from the line, indicating potential outliers or heavier tails than expected under normality. The District of Columbia appears to be an outlier with a large negative residual.


**ANALYSIS**


*ANALYSIS BASED ON PLOTS*

The analysis of math scores from 1992 to 2015 reveals interesting trends regarding the impact of instructional expenditure and the dynamics of gender differences in math performance across U.S. states. In 1992, a positive correlation between total expenditure on instruction and average math scores was evident, although the data points displayed considerable variability. This trend became more pronounced by 2015, where the correlation strengthened and the data points clustered more tightly around the upward-sloping trend line, suggesting a more consistent effect of increased instructional spending on math scores. Moreover, when adjusting for the proportion of total expenditure allocated to instruction rather than absolute values, both years showed an even stronger positive correlation. This underscores the importance of proportionate spending in instruction as a significant predictor of math performance, hinting at the effectiveness of targeted investments in educational resources.

In terms of gender differences, the analysis offers a compelling narrative of change over time. In 1992, men generally outperformed women in math, as indicated by higher medians and quartiles in the box plot distributions and a predominance of states showing a positive gender difference in favor of men. By 2015, however, this gap had not only narrowed but in many cases reversed, with the box plots showing comparable performance between genders and histograms indicating a leftward skew in gender difference scores — women now outperformed men in most states. This shift is further supported by the quantile-quantile plots, which suggest a move towards a less normal distribution in 2015, reflecting the notable improvement in women’s math scores relative to men's. This change could be attributed to various educational and societal developments over the 23 years that have increasingly leveled the playing field in STEM-related fields.

*ANALYSIS FROM TESTS* 

The application of the Welch Two Sample t-test to assess gender differences in average math scores among states in 1992 and 2015 provides valuable insights into the evolution of educational outcomes. In 1992, the test yielded a t-value of 0.79624 with a degrees of freedom (df) of 81.902, resulting in a p-value of 0.4282. This high p-value indicates that the observed difference in average math scores between males and females (mean of x = 267.2857, mean of y = 265.5000) was not statistically significant. The confidence interval ranged from -2.675791 to 6.247219, spanning zero, further suggesting that the difference in means could feasibly be zero, thus supporting the null hypothesis that there is no significant difference between male and female math scores in 1992.

Fast forward to 2015, the Welch t-test results mirror the conclusions drawn in 1992 regarding gender differences, with even stronger evidence supporting the null hypothesis. The t-value of -0.17853 and a df of 99.178 produced a p-value of 0.8587, demonstrating that the difference in math scores between genders (mean of x = 281.6471, mean of y = 281.9020) remained statistically insignificant. The 95% confidence interval for this difference, from -3.087821 to 2.578017, also includes zero. These results indicate a continued absence of gender disparities in math performance across states, consistent with the narrowing gap observed in descriptive statistics from the same year.

Furthermore, examining the change in overall math scores from 1992 to 2015 across all states reveals a significant improvement. The Welch t-test comparing the average math scores of all states between these two years shows a substantial mean increase from 266.2857 in 1992 to 281.7255 in 2015. With a t-value of -8.2789 and a very small p-value close to zero, the test strongly rejects the null hypothesis, indicating a significant rise in math scores over this period. The confidence interval, ranging from -19.15833 to -11.72122, does not include zero, which solidifies the conclusion of a real, positive shift in educational performance.

Lastly, bootstrapped correlations provide further context to these findings, showing a range of possible correlation values between the variables studied. For 1992, the correlation interval spans from -0.1571800 to 0.4839411, and for 2015, it adjusts slightly to -0.04643523 to 0.53185830. These intervals suggest a variability in the strength and direction of the correlations, reflecting the complex interplay of factors affecting math scores across states over time. Such variability underscores the importance of considering multiple analytical approaches to understand trends thoroughly, especially in educational data where numerous socio-economic factors can influence outcomes.




**Conclusions and Summary**

*This comprehensive analysis of U.S. education data from 1992 to 2015 offers valuable insights into the dynamics of educational expenditure and academic performance at the state level. Our findings reveal a noticeable improvement in math scores over the period, underpinned by a stronger correlation between instructional spending and academic outcomes in 2015 compared to 1992. Particularly significant is the shift in gender performance in math; while men generally outscored women in 1992, the gap narrowed or even reversed in many states by 2015, highlighting a progressive change towards gender parity in education. Statistical tests confirm these observations, showing no significant gender-based differences in math scores by 2015. Furthermore, the analysis underscores the importance of proportional investment in instruction relative to total educational expenditure, suggesting that targeted funding is crucial for improving academic outcomes. These trends reflect broader educational advancements and shifts in policy focus over the twenty-three-year span, marking a positive shift towards more equitable and effective education systems across the U.S.*
